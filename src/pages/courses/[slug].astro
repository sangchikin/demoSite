---
import { getCollection, render } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import FormattedDate from '../../components/FormattedDate.astro';

export async function getStaticPaths() {
    const courses = await getCollection('courses');
    return courses.map((course) => ({
        params: { slug: course.id },
        props: { course }
    }));
}

const { course } = Astro.props;
const { Content } = await render(course);
const { title, description, difficulty, duration, category, author, publishDate, updatedDate } = course.data;
---

<BaseLayout title={title} description={description}>
    <article class="max-w-3xl mx-auto py-12">
        <header class="mb-8">
            <div class="flex items-center gap-2 mb-4">
                {difficulty && (
                    <span class="text-xs font-medium px-3 py-1 rounded bg-green-100 text-green-800">
                        {difficulty}
                    </span>
                )}
                {category && (
                    <span class="text-xs font-medium px-3 py-1 rounded bg-blue-100 text-blue-800">
                        {category}
                    </span>
                )}
            </div>

            <h1 class="font-serif text-4xl font-medium tracking-tight mb-4">{title}</h1>

            <div class="flex flex-col sm:flex-row sm:items-center gap-4 text-sm opacity-75">
                {author && <span>By <strong>{author}</strong></span>}
                <FormattedDate date={publishDate} />
                {duration && <span>• Duration: {duration}</span>}
            </div>

            {updatedDate && (
                <p class="text-xs opacity-60 mt-2">
                    Last updated on <FormattedDate date={updatedDate} />
                </p>
            )}
        </header>

        <div class="prose prose-sm md:prose-base max-w-none mb-12">
            <Content />
        </div>

        <footer class="border-t border-opacity-20 pt-8">
            <a href="/courses" class="text-sm font-medium hover:opacity-75 transition">
                ← Back to all courses
            </a>
        </footer>
    </article>
</BaseLayout>
