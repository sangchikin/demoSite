---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import FormattedDate from '../../components/FormattedDate.astro';

export async function getStaticPaths() {
    const resources = await getCollection('resources');
    return resources.map((resource) => ({
        params: { slug: resource.id },
        props: { resource }
    }));
}

const { resource } = Astro.props;
const { Content } = await resource.render();
const { title, description, resourceType, category, publishDate, updatedDate, downloadUrl, tags } = resource.data;

const resourceIcons: Record<string, string> = {
    'Guide': 'ğŸ“–',
    'Template': 'ğŸ“‹',
    'Tool': 'ğŸ› ï¸',
    'Article': 'ğŸ“',
    'Video': 'ğŸ¥'
};

const resourceIcon = resourceIcons[resourceType] || 'ğŸ“„';
---

<BaseLayout title={title} description={description}>
    <article class="max-w-3xl mx-auto py-12">
        <header class="mb-8">
            <div class="flex items-center gap-2 mb-4">
                {resourceType && (
                    <span class="text-xs font-medium px-3 py-1 rounded bg-indigo-100 text-indigo-800">
                        {resourceIcon} {resourceType}
                    </span>
                )}
                {category && (
                    <span class="text-xs font-medium px-3 py-1 rounded bg-teal-100 text-teal-800">
                        {category}
                    </span>
                )}
            </div>

            <h1 class="font-serif text-4xl font-medium tracking-tight mb-4">{title}</h1>

            <div class="flex flex-col sm:flex-row sm:items-center gap-4 text-sm opacity-75">
                <FormattedDate date={publishDate} />
                {downloadUrl && (
                    <a href={downloadUrl} class="text-sm font-medium hover:opacity-75 transition">
                        â¬‡ï¸ Download
                    </a>
                )}
            </div>

            {updatedDate && (
                <p class="text-xs opacity-60 mt-2">
                    Last updated on <FormattedDate date={updatedDate} />
                </p>
            )}

            {tags && tags.length > 0 && (
                <div class="flex flex-wrap gap-2 mt-4">
                    {tags.map((tag) => (
                        <a href={`/tags/${tag}`} class="text-xs font-medium px-2 py-1 rounded bg-opacity-10 hover:opacity-75 transition">
                            #{tag}
                        </a>
                    ))}
                </div>
            )}
        </header>

        <div class="prose prose-sm md:prose-base max-w-none mb-12">
            <Content />
        </div>

        {downloadUrl && (
            <div class="bg-opacity-5 border border-opacity-20 rounded-sm p-6 mb-8">
                <p class="text-sm mb-3">Ready to get this resource?</p>
                <a 
                    href={downloadUrl}
                    class="inline-block bg-brand-accent text-brand-bg px-6 py-3 rounded-sm font-medium hover:opacity-90 transition"
                >
                    â¬‡ï¸ Download Now
                </a>
            </div>
        )}

        <footer class="border-t border-opacity-20 pt-8">
            <a href="/resources" class="text-sm font-medium hover:opacity-75 transition">
                â† Back to all resources
            </a>
        </footer>
    </article>
</BaseLayout>
