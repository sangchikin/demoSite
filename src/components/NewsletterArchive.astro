---
import { type CollectionEntry } from 'astro:content';
import FormattedDate from './FormattedDate.astro';

type Props = {
    newsletters: CollectionEntry<'newsletter'>[];
    class?:  string;
};

const { newsletters, class: className } = Astro.props;

// Group newsletters by year
const groupedByYear = newsletters.reduce(
    (acc, newsletter) => {
        const year = new Date(newsletter.data.publishDate).getFullYear();
        if (!acc[year]) acc[year] = [];
        acc[year].push(newsletter);
        return acc;
    },
    {} as Record<number, CollectionEntry<'newsletter'>[]>
);

// Sort years descending
const sortedYears = Object.keys(groupedByYear)
    .map(Number)
    .sort((a, b) => b - a);
---

<div class: list={['space-y-12', className]}>
    {sortedYears.map((year) => (
        <section class="mb-16 sm:mb-24">
            <div class="flex items-center gap-4 mb-8">
                <h3 class="font-sans text-4xl font-bold">Nhật ký</h3>
                <span class="px-4 py-2 rounded-full border-2 border-main text-main font-medium text-sm">
                    {year}
                </span>
            </div>

            <div class="space-y-0 divide-y divide-main/10">
                {groupedByYear[year].map((newsletter) => (
                    <a
                        href={`/newsletter/${newsletter.id}`}
                        class="group flex items-center justify-between py-4 px-6 hover:bg-muted/50 transition-colors"
                    >
                        <div class="flex-1 min-w-0">
                            <h3 class="font-serif text-lg font-medium group-hover:underline truncate">
                                {newsletter.data. title}
                            </h3>
                        </div>
                        <div class="ml-4 flex-shrink-0 text-sm text-main/70">
                            <FormattedDate date={newsletter.data.publishDate} />
                        </div>
                    </a>
                ))}
            </div>
        </section>
    ))}
</div>