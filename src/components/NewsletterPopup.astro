---
// Optional: Show modal after user has been on site for 30 seconds
// Add to BaseLayout.astro if you want popup feature

type Props = {
    delayMs?: number;
    cookieName?: string;
};

const { delayMs = 30000, cookieName = 'newsletter_popup_shown' } = Astro. props;
---

<div id="newsletter-popup" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
    <div class="bg-main rounded-lg max-w-md w-full p-8 animate-in fade-in duration-300">
        <button 
            id="close-popup"
            class="absolute top-4 right-4 text-main/50 hover:text-main"
            aria-label="Close"
        >
            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
            </svg>
        </button>

        <h3 class="font-serif text-2xl font-medium mb-3 text-bg-main">
            Don't Miss Out
        </h3>
        <p class="text-bg-main/70 mb-6">
            Get exclusive insights on long-term investing delivered to your inbox every week.
        </p>

        <form id="popup-form" class="space-y-4">
            <input
                type="email"
                name="email"
                placeholder="your@email.com"
                required
                class="w-full px-4 py-3 rounded-lg border border-bg-main/20 text-bg-main bg-bg-main/5 focus:outline-none focus:ring-2 focus:ring-bg-main/20"
            />
            <button
                type="submit"
                class="w-full px-4 py-3 bg-bg-main text-main font-serif font-medium rounded-lg hover:opacity-90 transition-opacity"
            >
                Subscribe Free
            </button>
        </form>

        <p class="text-xs text-bg-main/60 text-center mt-4">
            We respect your privacy. Unsubscribe anytime.
        </p>
    </div>
</div>

<script>
    // Show popup after delay
    const cookieName = 'newsletter_popup_shown';
    const delayMs = 30000;

    if (! localStorage.getItem(cookieName)) {
        setTimeout(() => {
            const popup = document.getElementById('newsletter-popup');
            const closeBtn = document.getElementById('close-popup');
            const form = document.getElementById('popup-form');

            if (popup && closeBtn) {
                popup.classList.remove('hidden');
                popup.classList.add('flex');

                closeBtn.addEventListener('click', () => {
                    popup.classList. add('hidden');
                    popup.classList.remove('flex');
                    localStorage.setItem(cookieName, 'true');
                });

                // Form submission
                form?. addEventListener('submit', (e) => {
                    e.preventDefault();
                    // Send to your email service
                    console.log('Form submitted');
                    popup.classList.add('hidden');
                    localStorage.setItem(cookieName, 'true');
                });
            }
        }, delayMs);
    }
</script>